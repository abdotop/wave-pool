# Wave Pool Flutter App

This Flutter application simulates the client-side experience for Wave payments. It handles QR code scanning and payment simulation via deep links.

## Features

### 1. QR Code Scanner
- Scan QR codes generated by the Wave Pool payment pages
- Automatically detect and parse Wave Pool deep links
- Navigate to payment simulation when valid codes are detected

### 2. Payment Simulation
- Display payment details (amount, currency, merchant)
- Two large buttons for simulating payment success/failure
- Send payment status updates to the backend API
- Handle deep links from external sources (web browser, other apps)

### 3. Deep Link Handling
- Custom URL scheme: `wavepool://pay/{session_id}`
- Automatic parsing of payment session IDs
- Integration with backend API to fetch session details

## Technical Implementation

### Dependencies
- `mobile_scanner`: QR code scanning functionality
- `http`: HTTP requests to backend API
- `url_launcher`: Handle external URLs (future extension)

### Deep Link Configuration

#### Android
- Configured in `android/app/src/main/AndroidManifest.xml`
- Handles `wavepool://` scheme
- Network security config allows localhost connections for development

#### iOS
- Configured in `ios/Runner/Info.plist`
- URL scheme registration for `wavepool://`
- Camera permissions for QR code scanning

## Usage Flow

1. **Web Portal Creates Payment Session**
   - Merchant creates checkout session via API
   - Web portal displays QR code with deep link: `wavepool://pay/cos-xxx`

2. **Mobile App Scans QR Code**
   - User opens Wave Pool mobile app
   - Navigates to QR Scanner tab
   - Points camera at QR code on payment page

3. **Payment Simulation**
   - App detects QR code and extracts session ID
   - Fetches payment details from backend API
   - Displays payment information to user
   - User chooses "Simulate Success" or "Simulate Failure"
   - App sends payment status to backend via POST /pay/{session_id}

4. **Backend Processing**
   - Backend updates checkout session status
   - Triggers webhooks (when implemented)
   - Web portal reflects updated transaction status

## Setup Instructions

### Prerequisites
- Flutter SDK (3.0 or higher)
- Android Studio / Xcode for device testing
- Wave Pool backend running locally

### Installation
1. Navigate to the flutter_app directory:
   ```bash
   cd flutter_app
   ```

2. Install dependencies:
   ```bash
   flutter pub get
   ```

3. Run the app:
   ```bash
   flutter run
   ```

### Configuration
- Backend URL is hardcoded to `http://localhost:8081`
- For production, this should be configurable
- API key is set to `demo_api_key` for development

## Testing

### Manual Testing
1. Start the Wave Pool backend server
2. Create a checkout session via the web portal or API
3. Open the payment page in a browser to see the QR code
4. Run the Flutter app on a physical device (camera needed)
5. Use the QR Scanner tab to scan the payment QR code
6. Test both success and failure payment simulations

### Deep Link Testing
You can also test deep links directly:
```bash
# Android (using adb)
adb shell am start \
  -W -a android.intent.action.VIEW \
  -d "wavepool://pay/cos-12345" \
  com.example.wave_pool_app

# iOS (using Simulator)
xcrun simctl openurl booted "wavepool://pay/cos-12345"
```

## Architecture

### UI Structure
```
WavePoolApp (MaterialApp)
├── HomePage (TabBar)
│   ├── PaymentSimulatorPage (Main payment UI)
│   └── QRScannerPage (Camera scanning)
└── PaymentSimulatorPageWithSession (Direct session handling)
```

### API Integration
- GET `/v1/checkout/sessions/{id}` - Fetch payment session details
- POST `/pay/{session_id}` - Submit payment simulation result

### State Management
- Uses StatefulWidget for local state management
- HTTP requests with error handling and loading states
- Navigation between screens based on scan results

## Future Enhancements

1. **Improved Deep Link Handling**
   - Use `app_links` package for better link handling
   - Handle app state restoration from deep links

2. **Configuration Management**
   - Environment-based backend URL configuration
   - API key management and storage

3. **Enhanced UI/UX**
   - Animation transitions
   - Better error handling and retry mechanisms
   - Offline support and caching

4. **Security**
   - Certificate pinning for production
   - Secure storage for sensitive data

5. **Testing**
   - Unit tests for business logic
   - Widget tests for UI components
   - Integration tests for full user flows

## Notes

This is a simulation app designed for testing and development. In a real Wave integration, the mobile experience would be provided by the official Wave app, and this simulator helps developers test their integration without needing real Wave infrastructure.